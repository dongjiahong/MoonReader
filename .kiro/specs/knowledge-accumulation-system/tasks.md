# Implementation Plan

- [x] 1. 设置后端项目基础结构和依赖
  - 在moon_reader/Cargo.toml中添加所需依赖（axum, sqlx, tokio, serde等）
  - 创建基本的项目模块结构（handlers, models, services, database）
  - 设置基本的main.rs文件和路由框架
  - _Requirements: 1.1, 2.1, 3.1, 4.1, 5.1_

- [x] 2. 实现数据库层和数据模型
  - [x] 2.1 创建数据库Schema和迁移脚本
    - 编写SQL创建表的脚本（knowledge_bases, documents, questions, answers等）
    - 实现数据库初始化和迁移功能
    - _Requirements: 1.1, 1.2, 2.1, 3.1, 5.1_

  - [x] 2.2 实现数据模型结构体
    - 定义Rust结构体对应数据库表（KnowledgeBase, Document, Question, Answer等）
    - 实现Serde序列化/反序列化
    - 添加数据验证逻辑
    - _Requirements: 1.1, 2.1, 3.1, 5.1_

  - [x] 2.3 实现数据访问层
    - 创建DatabaseManager结构体和连接池
    - 实现CRUD操作方法（创建、读取、更新、删除知识库）
    - 编写数据库操作的单元测试
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 3. 实现知识库管理API
  - [x] 3.1 实现知识库CRUD接口
    - 编写创建知识库的API处理器
    - 编写获取知识库列表的API处理器
    - 编写更新和删除知识库的API处理器
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

  - [x] 3.2 添加API错误处理和验证
    - 实现统一的错误处理中间件
    - 添加输入验证逻辑
    - 编写API集成测试
    - _Requirements: 1.1, 1.4, 6.4_

- [x] 4. 实现文档解析和管理功能
  - [x] 4.1 实现文档解析器
    - 创建PDF解析器（使用pdf-extract crate）
    - 创建EPUB解析器（使用epub crate）
    - 创建TXT文件解析器
    - 编写解析器单元测试
    - _Requirements: 2.2, 2.3, 2.4_

  - [x] 4.2 实现文档上传API
    - 编写文件上传处理器
    - 实现文件类型验证和大小限制
    - 集成文档解析器处理上传的文件
    - 将解析后的内容存储到数据库
    - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_

  - [x] 4.3 实现文档管理API
    - 编写获取文档列表的API
    - 编写删除文档的API
    - 实现文档内容预览功能
    - _Requirements: 2.1, 2.6_

- [x] 5. 实现AI服务集成
  - [x] 5.1 创建AI服务抽象层
    - 定义AIProvider trait接口
    - 实现DeepSeek API集成
    - 实现本地AI接口集成
    - 创建AI服务工厂模式
    - _Requirements: 4.2, 4.3_

  - [x] 5.2 实现AI配置管理
    - 编写AI配置的数据模型和数据库操作
    - 实现AI配置的保存和读取API
    - 实现AI连接测试功能
    - _Requirements: 4.1, 4.4, 4.5, 4.6_

  - [x] 5.3 实现AI问答功能
    - 编写基于知识库内容生成问题的逻辑
    - 实现问题生成API
    - 实现答案评估API
    - 编写AI服务的单元测试
    - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 6. 实现复习模块后端功能
  - [x] 6.1 实现历史记录管理
    - 编写问答历史的数据库操作
    - 实现历史记录查询和筛选API
    - 实现复习会话管理
    - _Requirements: 5.4, 5.5_

  - [x] 6.2 实现复习功能
    - 编写随机选择历史问题的逻辑
    - 实现复习问题API
    - 实现学习进步跟踪功能
    - _Requirements: 5.1, 5.2, 5.3, 5.6_

- [x] 7. 设置前端项目基础和依赖
  - 在reader_ui/package.json中添加所需依赖（axios, element-plus等）
  - 配置Vue Router路由结构
  - 设置Vuex状态管理
  - 创建基本的布局组件和导航
  - _Requirements: 6.1, 6.2_

- [x] 8. 实现前端知识库管理界面
  - [x] 8.1 创建知识库列表组件
    - 实现知识库列表显示
    - 添加创建新知识库的表单
    - 实现知识库编辑和删除功能
    - 集成API调用和错误处理
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

  - [x] 8.2 创建文档管理组件
    - 实现文档列表显示
    - 添加文件上传组件
    - 实现文档删除功能
    - 添加上传进度和状态显示
    - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6_

- [x] 9. 实现前端AI问答界面
  - [x] 9.1 创建AI问答组件
    - 实现问题显示和答案输入界面
    - 添加生成新问题的功能
    - 实现答案提交和评估结果显示
    - 添加加载状态和错误处理
    - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

  - [x] 9.2 创建AI配置界面
    - 实现AI服务提供商选择
    - 添加API密钥和URL配置表单
    - 实现配置保存和连接测试
    - 添加配置验证和错误提示
    - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6_

- [x] 10. 实现前端复习模块界面
  - [x] 10.1 创建复习组件
    - 实现随机复习问题显示
    - 添加复习答案输入和提交
    - 实现学习进步显示
    - 添加复习会话管理
    - _Requirements: 5.1, 5.2, 5.3, 5.6_

  - [x] 10.2 创建历史记录组件
    - 实现问答历史列表显示
    - 添加历史记录筛选功能
    - 实现历史记录详情查看
    - 添加分页和搜索功能
    - _Requirements: 5.4, 5.5_

- [x] 11. 实现响应式设计和用户体验优化
  - 添加移动端适配的CSS样式
  - 实现加载状态指示器
  - 优化错误消息显示
  - 添加用户操作确认对话框
  - _Requirements: 6.2, 6.3, 6.4, 6.5_

- [x] 12. 集成测试和系统测试
  - [x] 12.1 编写端到端测试
    - 测试完整的知识库创建到问答流程
    - 测试文档上传和解析功能
    - 测试AI问答和复习功能
    - 验证错误处理和边界情况
    - _Requirements: 所有需求_

  - [x] 12.2 性能优化和测试
    - 优化大文件上传和解析性能
    - 测试AI API响应时间
    - 优化数据库查询性能
    - 测试前端组件渲染性能
    - _Requirements: 2.2, 2.3, 2.4, 3.1, 3.2_